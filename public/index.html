<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Meta Information -->
    <title>Tweeter - Home Page</title>

    <!-- External CSS -->
    <link rel="stylesheet" href="/vendor/normalize-4.1.1.css" type="text/css" />
    <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300,300i,700,700i" rel="stylesheet">
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- App CSS -->
    <link rel="stylesheet" href="/styles/layout.css" type="text/css" />
    <link rel="stylesheet" href="/styles/nav.css" type="text/css" />
    <link rel="stylesheet" href="/styles/new-tweet.css" type="text/css" />
    <link rel="stylesheet" href="/styles/tweets.css" type="text/css" />

    <!-- External JS -->
    <script type="text/javascript" src="/vendor/jquery-2.2.3.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment-with-locales.min.js"></script>

    <!-- App JS -->
    <script type="text/javascript" src="/scripts/app.js"></script>
    <script type="text/javascript" src="/scripts/composer-char-counter.js"></script>
  </head>

  <body>
    
    <!-- Top nav bar (fixed) -->
    <nav id="nav-bar">
      <img class="logo" src="/images/bird.png">
      <span class="header">Tweeter</span>
      <button class="button"><i class="fa fa-pencil"></i>Compose</button>
    </nav>

    <!-- Page-specific (main) content here -->
    <main class="container" hidden>
        <section class="new-tweet" hidden>
            <h2 id="compose">Compose Tweet</h2>
            <div class="error" hidden></div>  
            <form method="POST" action="/tweets">
              <textarea id="compose-tweet" name="text" placeholder="What are you humming about?"></textarea>
              <input type="submit" value="Tweet">
              <span class="counter" class="counter-invalid">140</span>
            </form>
        </section>
        
        <section id="tweets-container">
        </section>

        <!-- JS SCRIPTS -->
        <script> 
        // Hides main container on page reload
        $('document').ready(function() {
          $('.new-tweet').fadeToggle();
          $('.container').fadeToggle();
        });
        </script>
        
        <script>
          // jQuery used to prevent form submit button's default event and later submit with form with AJAX
          $("form").submit(function(event) {
            event.preventDefault();

            /* Conditions to ensure users cannot submit empty tweets or tweets beyond the character limit.
            Error messages will display if conditions are met, otherwise AJAX post request will serialize and submit the
            form to /tweets, then reload the homepage with the new tweet.
            */
            let $textAreaValue = $('#compose-tweet').val();
            if ($textAreaValue.length > 140) {
                $('.error').text("Error! Character count cannot exceed 140. Please compose a tweet of 140 characters or less.");
                $('.error').hide();
                $('.error').slideDown(function () {
                  $("form").submit(function(event) {
                    $('.error').hide();
                    $('.error').slideDown();
                  });
                });
                return;
              } else if ($textAreaValue === '') {
                $('.error').text('Error! Textbox is empty. Please enter some characters in the textbox to compose your tweet.');
                $('.error').hide();
                $('.error').slideDown(function () {
                  $("form").submit(function(event) {
                    $('.error').hide();
                    $('.error').slideDown();
                  });
                });
                return;
              } else {
                $('.error').hide();
                // AJAX POST request to add tweet to homepage and reload homepage on submit
                $.post("/tweets", $('form').serialize());
                location.reload(true);
              }   
            });
        </script>

        <script>
          // JS code to toggle the compose-tweet box on and off when compose button is clicked and focus textbox when clicked
          $('.button').click(function () {
            $(".new-tweet").slideToggle(function () {
              $('#compose-tweet').focus();
            });
          });
        </script>
    </main>
  </body>
</html>
